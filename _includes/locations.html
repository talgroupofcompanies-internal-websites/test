<!-- _includes/locations.html -->

<style>
  #locations {
    background-color: var(--bg-light);
  }
  /* Force the map and its controls below the nav and other content */
  #locations-map,
  #locations-map .leaflet-pane,
  #locations-map .leaflet-control-container {
    position: relative;
    z-index: 0 !important;
  }

  /* ─── Locations Section ─── */
  #locations {
    padding: 4rem 0;
  }
  #locations h2 {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--primary);
  }

  /* Map container */
  #locations-map {
    width: 100%;
    height: 400px;
    border-radius: var(--border-radius-1);
    margin-bottom: 2rem;
  }

  /* Default list: flex wrap, centered rows */
  #locations .areas {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin: 0 auto;
    padding: 0;
    list-style: none;
    max-width: 800px;
  }
  #locations .areas li {
    text-align: center;
    margin-bottom: 0.75rem;
  }
  #locations .areas li i {
    color: var(--accent);
    margin-right: 0.5rem;
  }

  /* Special 5-item layout: 5-column grid with offsets */
  #locations .areas.special-5 {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
    margin: 0 auto;
    padding: 0;
    list-style: none;
    max-width: 800px;
  }
  #locations .areas.special-5 li:nth-child(1) { grid-column: 2; grid-row: 1; }
  #locations .areas.special-5 li:nth-child(2) { grid-column: 3; grid-row: 1; }
  #locations .areas.special-5 li:nth-child(3) { grid-column: 4; grid-row: 1; }
  #locations .areas.special-5 li:nth-child(4) { grid-column: 2; grid-row: 2; }
  #locations .areas.special-5 li:nth-child(5) { grid-column: 4; grid-row: 2; }

  /* ─── MOBILE OVERRIDE (≤600px) ─── */
  @media (max-width: 600px) {
    /* make the second container (the UL wrapper) truly full-width */
    #locations > .container:last-of-type {
      width: 100% !important;
      max-width: none !important;
      margin: 0 !important;
      padding: 0 1rem !important;
    }

    /* force both default and special lists into a 2-column grid */
    #locations .areas,
    #locations .areas.special-5 {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 1rem;
      margin: 0 auto;
      padding: 0;
    }

    /* cancel out the desktop-only nth-child positioning */
    #locations .areas.special-5 li {
      grid-column: auto !important;
      grid-row: auto !important;
    }

    /* ensure each item sits in its column */
    #locations .areas li {
      margin-bottom: 0.75rem;
    }
  }
</style>

<!-- Leaflet CSS & JS (no API key needed) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<section id="locations">
  <div class="container">
    <h2>Our Dispatch Locations</h2>
    <div id="locations-map"></div>
  </div>

  <div class="container">
    {% assign n = site.locations | size %}
    <ul class="areas{% if n == 5 %} special-5{% endif %}">
      {% for loc in site.locations %}
        <li>
          <i class="fas fa-map-marker-alt"></i>{{ loc.name }}
        </li>
      {% endfor %}
    </ul>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const coords = [
      {% for loc in site.locations %}
        [{{ loc.coordinates }}]{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];
    const map = L.map("locations-map").setView(coords[0], 11);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);
    coords.forEach(c => L.marker(c).addTo(map));
  });
</script>

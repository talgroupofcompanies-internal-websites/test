<!-- _includes/locations.html -->

<style>
  /* Locations Section */
  #locations {
    padding: 4rem 0;
  }
  #locations h2 {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--primary);
  }

  /* Map container */
  #locations-map {
    width: 100%;
    height: 400px;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
  }

  /* Locations list: flex wrap, centered rows */
  #locations .areas {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin: 0 auto;
    padding: 0;
    list-style: none;
  }
  /* 1â€“6 column splits */
  #locations .areas.grid-cols-1 li { flex: 0 0 100%; }
  #locations .areas.grid-cols-2 li { flex: 0 0 50%; }
  #locations .areas.grid-cols-3 li { flex: 0 0 calc(100%/3); }
  #locations .areas.grid-cols-4 li { flex: 0 0 25%; }
  #locations .areas.grid-cols-5 li { flex: 0 0 20%; }
  #locations .areas.grid-cols-6 li { flex: 0 0 calc(100%/6); }

  #locations .areas li {
    text-align: center;
    margin-bottom: 0.75rem;
  }
  #locations .areas li i {
    color: var(--accent);
    margin-right: 0.5rem;
  }
</style>

<!-- Leaflet CSS/JS (no API key needed) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<section id="locations">
  <div class="container">
    <h2>Service Areas</h2>
    <div id="locations-map"></div>
  </div>

  <div class="container">
    {% assign n = site.locations | size %}
    {% if n <= 4 %}
      {% assign cols = n %}
    {% elsif n | modulo: 2 == 0 %}
      {% assign cols = n | divided_by: 2 %}
    {% else %}
      {% assign cols = 4 %}
    {% endif %}

    <ul class="areas grid-cols-{{ cols }}">
      {% for loc in site.locations %}
        <li>
          <i class="fas fa-map-marker-alt"></i>{{ loc.name }}
        </li>
      {% endfor %}
    </ul>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Build coords array without trailing commas
    const coords = [
      {% for loc in site.locations %}
        [{{ loc.coordinates }}]{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    // Initialize Leaflet map
    const map = L.map("locations-map").setView(coords[0], 11);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // Add a marker for each location
    coords.forEach(c => L.marker(c).addTo(map));
  });
</script>
